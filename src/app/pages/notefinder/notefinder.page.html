<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>

    <ion-item lines="none">
      <ion-title style="padding: 0; text-align: left;">
        {{'home.notefinder' | translate}}
      </ion-title>
      <ion-icon name="information-circle-outline" color="medium" size="large" slot="end" (click)="openModal()">
      </ion-icon>
    </ion-item>

  </ion-toolbar>
</ion-header>
<ion-content>

  <ion-item>
    <label *ngIf="!key"> {{'notefinder.insert' | translate}} </label>
    <ion-select [(ngModel)]="key" slot="end" color="light" interface="popover" (ionChange)="searchChord()">
      <ion-select-option *ngFor="let note of scale" [value]="note"> {{ note | musicNotation }}</ion-select-option>
    </ion-select>
  </ion-item>

  <ion-grid>
    <ion-row>
      <ion-col size="3" *ngFor="let tile of typesTiles">
        <ion-button [color]="tile.color" expand="block" class="button-tiles" (click)="selectTypeTile(tile)">
          {{'notefinder.'+tile.name | translate}}
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-grid>
    <ion-row>
      <ion-col size="12/5" *ngFor="let tile of gradesTiles">
        <ion-button [color]="tile.color" expand="block" class="button-tiles" (click)="selectGradeTile(tile)">
          {{tile.name | musicNotation}}
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-searchbar animated="true" class="button-tiles" [placeholder]="'notefinder.search' | translate" color="light"
    (ionChange)="getChords($event)"></ion-searchbar>

  <br>



  <ion-grid>
    <ion-row>
      <ion-col>
        <ng-container *ngIf="filteredChords.length > 0 ">
          <ion-card *ngFor="let chord of filteredChords" class="card outer">
            <ng-container *ngIf="!chord.show; else chordShowed">
              <ion-card-header (click)="toggleCard(chord)">
                <ion-card-title class="card-title-symbol">{{chord.symbol | musicNotation}}</ion-card-title>
              </ion-card-header>

            </ng-container>

            <ng-template #chordShowed>
              <ion-card-header>
                <ion-card class="card inner" style="margin-top: 0;" (click)="toggleCard(chord)">
                  <ion-card-header>
                    <ion-card-title class="card-title-symbol">{{chord.symbol | musicNotation}}</ion-card-title>

                    <ion-card-subtitle class="card-subtitle">
                      <ng-container *ngIf="chord.name.length > 2">
                        <ion-text *ngFor="let word of chord.name">
                          {{word | musicNotation | translate}}
                        </ion-text><br>
                      </ng-container>
                      <ion-text>
                        {{'aliases' | translate}}:
                      </ion-text>
                      <ion-text *ngFor="let alias of chord.aliases"> {{alias | musicNotation}} </ion-text>
                    </ion-card-subtitle>
                  </ion-card-header>
                </ion-card>

                <ion-card class="card inner">
                  <ion-card-header>

                    <ion-grid>
                      <ion-row *ngFor="let note of chord.notes; index as i">
                        <ion-col size="2" style="font-weight: bold;">{{note | musicNotation}}</ion-col>
                        <ion-col size="2">{{chord.intervals.symbols[i]}}</ion-col>

                        <ion-col *ngIf="global.language == 'en'" style="text-transform: capitalize;">
                          {{chord.intervals.quality[i] | translate}}
                          {{chord.intervals.numbers[i] | translate}} </ion-col>

                        <ion-col *ngIf="global.language == 'it'" style="text-transform: capitalize;">
                          {{chord.intervals.numbers[i] | translate}} {{chord.intervals.quality[i] | translate}}
                        </ion-col>

                      </ion-row>
                    </ion-grid>
                  </ion-card-header>
                </ion-card>


                <ion-card class="card inner" *ngIf="chord.extensions.values.length != 0">
                  <ion-card-header>
                    <ion-text> {{'extensions' | translate}}: <br> <br></ion-text>

                    <ng-container *ngIf="!chord.extensions.open; else extenionsOpened">
                      <ion-text *ngFor="let mychord of chord.extensions.values.slice(0,3); last as isLast"
                        (click)="inputChord(mychord)">
                        <ion-text class="linkChord">{{mychord | musicNotation}}</ion-text>
                        <ion-text *ngIf="!isLast"> , </ion-text>
                      </ion-text>
                    </ng-container>

                    <ng-template #extenionsOpened>
                      <ion-text *ngFor="let mychord of chord.extensions.values; last as isLast"
                        (click)="inputChord(mychord)">
                        <ion-text class="linkChord">{{mychord | musicNotation}}</ion-text>
                        <ion-text *ngIf="!isLast"> , </ion-text>
                      </ion-text>
                    </ng-template>

                    <ion-icon color="secondary" name="ellipsis-horizontal" style="padding-left: 3%;"
                      *ngIf="chord.extensions.values.length > 3" (click)="toggleEllipsis('extensions')">
                    </ion-icon>

                  </ion-card-header>
                </ion-card>


                <ion-card class="card inner" *ngIf="chord.reductions.values.length != 0">
                  <ion-card-header>
                    <ion-text> {{'reductions' | translate}}: <br> <br></ion-text>

                    <ion-text *ngIf="!chord.reductions.open; else reductionsOpened">
                      <ion-text class="linkChord"
                        *ngFor="let mychord of chord.reductions.values.slice(0,3); last as isLast"
                        (click)="inputChord(mychord)">
                        <ion-text class="linkChord">{{mychord | musicNotation}}</ion-text>
                        <ion-text *ngIf="!isLast"> , </ion-text>
                      </ion-text>
                    </ion-text>

                    <ng-template #reductionsOpened>
                      <ion-text class="linkChord" *ngFor="let mychord of chord.reductions.values; last as isLast"
                        (click)="inputChord(mychord)">
                        <ion-text class="linkChord">{{mychord | musicNotation}}</ion-text>
                        <ion-text *ngIf="!isLast"> , </ion-text>
                      </ion-text>
                    </ng-template>

                    <ion-icon color="secondary" name="ellipsis-horizontal" style="padding-left: 3%;"
                      *ngIf="chord.reductions.values.length > 3" (click)="toggleEllipsis('reductions')">
                    </ion-icon>

                  </ion-card-header>
                </ion-card>

                <ion-card class="card inner" style="margin-bottom: 0;">

                  <ion-grid>
                    <ion-row>
                      <ion-col class="ion-text-center">
                        <ion-button color="secondary" (click)="playChord(chord, 'chord')"> {{'play_chord' | translate}}
                        </ion-button>
                      </ion-col>
                      <ion-col class="ion-text-center">
                        <ion-button color="secondary" (click)="playChord(chord, 'arp')"> {{'play_arp' | translate}}
                        </ion-button>
                      </ion-col>
                    </ion-row>
                  </ion-grid>

                </ion-card>
              </ion-card-header>
            </ng-template>

          </ion-card>
        </ng-container>


      </ion-col>
    </ion-row>
  </ion-grid>


</ion-content>